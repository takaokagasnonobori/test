<!CAMERATEST html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³ä¿å­˜</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2em;
    }
    #reader {
      width: 100%;
      max-width: 400px;
      margin: auto;
    }
    #result {
      margin-top: 1em;
      font-size: 1.3em;
      color: green;
    }
    button {
      font-size: 1.4em;
      padding: 0.7em 1.5em;
      margin: 1em;
    }
  </style>
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
  <h2>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³ & ä¿å­˜</h2>
  <div id="reader"></div>
  <div id="result">èª­ã¿å–ã‚ŠçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
  <button onclick="startScanner()">ğŸ“· ã‚¹ã‚­ãƒ£ãƒ³é–‹å§‹</button>
  <button onclick="stopScanner()">ğŸ›‘ ã‚¹ã‚­ãƒ£ãƒ³åœæ­¢</button>

  <script>
    let html5QrCode;
    const resultElement = document.getElementById("result");
    const scriptUrl = "https://script.google.com/macros/s/ã‚ãªãŸã®ãƒ‡ãƒ—ãƒ­ã‚¤URL/exec"; // â†ã“ã“ã«Google Apps Scriptã®URLã‚’æŒ¿å…¥

    function startScanner() {
      html5QrCode = new Html5Qrcode("reader");
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: { width: 250, height: 250 } },
        (decodedText) => {
          resultElement.textContent = `èª­ã¿å–ã‚ŠæˆåŠŸ: ${decodedText}`;
          sendToSheet(decodedText);
          html5QrCode.stop();
        },
        (errorMessage) => {
          console.log("èª­ã¿å–ã‚Šå¤±æ•—:", errorMessage);
        }
      ).catch((err) => {
        resultElement.textContent = `ã‚¨ãƒ©ãƒ¼: ${err}`;
      });
    }

    function stopScanner() {
      if (html5QrCode) {
        html5QrCode.stop().then(() => {
          resultElement.textContent = "ã‚¹ã‚­ãƒ£ãƒ³åœæ­¢ã—ã¾ã—ãŸ";
        }).catch((err) => {
          resultElement.textContent = `åœæ­¢ã‚¨ãƒ©ãƒ¼: ${err}`;
        });
      }
    }

    function sendToSheet(barcode) {
      fetch(scriptUrl, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `barcode=${encodeURIComponent(barcode)}`
      })
      .then(response => response.text())
      .then(text => {
        console.log("é€ä¿¡å®Œäº†:", text);
      })
      .catch(err => {
        console.error("é€ä¿¡ã‚¨ãƒ©ãƒ¼:", err);
      });
    }
  </script>
</body>
</html>
